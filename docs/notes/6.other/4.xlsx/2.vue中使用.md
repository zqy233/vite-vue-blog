# 示例

> 首先安装 npm i -s xlsx

## 根据表格生成xlsx

```js
  exportExcel() {
      // Acquire Data (reference to the HTML table)
      var table_elt = document.getElementById("my-table-id")
      // Extract Data (create a workbook object from the table)
      var workbook = XLSX.utils.table_to_book(table_elt)
      // Process Data (add a new row)
      var ws = workbook.Sheets["Sheet1"]
      XLSX.utils.sheet_add_aoa(ws, [["Created " + new Date().toISOString()]], { origin: -1 })
      // Package and Release Data (`writeFile` tries to write and save an XLSB file)
      XLSX.writeFile(workbook, "Report.xlsb")
    }
```

## 导入高德地图xlsx

1. 使用input type="file"选择xlsx文件
2. 使用fileReader读取文件为二进制编码
3. XLSX.read方法处理二进制编码为worksheet对象
4. XLSX.utils.sheet_to_json转换worksheet对象为json数据
5. 最后处理json数据为自己想要的格式即可

```js
<template>
  <article>
    <p>导入高德地图xlsx文件</p>
    <input type="file" ref="upload" accept=".xls,.xlsx" />
  </article>
</template>

<script>
import XLSX from "xlsx"
export default {
  mounted() {
    // 监听表格导入事件
    this.$refs.upload.addEventListener("change", e => {
      this.readExcel(e)
    })
  },
  methods: {
    readExcel(e) {
      console.log(e)
      //表格导入
      const files = e.target.files
      //如果没有文件名
      if (files.length <= 0) return
      // 上传文件格式不正确,非xls或者xlsx格式文件
      if (!/\.(xls|xlsx)$/.test(files[0].name.toLowerCase())) return
      const fileReader = new FileReader()
      // readAsBinaryString将文件读取为二进制编码
      fileReader.readAsBinaryString(files[0])
      // 读取完成
      fileReader.onload = ev => {
        try {
          // 二进制数据
          const data = ev.target.result
          // xlsx处理二进制数据
          const workbook = XLSX.read(data, {
            type: "binary"
          })
          console.log(workbook)
          const wsname = workbook.SheetNames[0] //取第一张表
          const ws = XLSX.utils.sheet_to_json(workbook.Sheets[wsname]) // 根据表格内容生成json数据
          console.log("天气json数据", ws)
          console.log("天气json数据", JSON.stringify(ws))
          const outputs = [] //清空接收数据
          for (let i = 0; i < ws.length; i++) {
            const sheetData = {
              value: ws[i].adcode,
              label: ws[i].中文名
            }
            outputs.push(sheetData)
          }
          // 最终处理好的数据
          console.log(outputs)
          // 清除input file的值
          this.$refs.upload.value = ""
        } catch (e) {
          console.log(e)
        }
      }
    }
  }
}
</script>
```

