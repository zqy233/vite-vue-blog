# 项目创建与配置

> 本章前提：需要了解 node 相关知识

## 使用@vue/cli 创建项目

@vue/cli 是 vue 官方的脚手架，可以使用其快速创建一个 vue 项目的模板

使用@vue/cli 可以安装 vue2 和 vue3 的模板，且都基于 webpack 打包工具

:::warning vue3 不支持 ie11

- 想要支持 ie11 请使用 vue2
- [官方说明](https://github.com/vuejs/rfcs/blob/master/active-rfcs/0038-vue3-ie11-support.md)
  :::

```bash
# 安装全局脚手架安装命令
npm i -g @vue/cli
# 创建项目,选择相应模板
vue create vue-project-name
# 进入项目目录
cd vue-project-name
# 使用vscode打开当前目录的项目
code ./
# npm运行项目
npm run serve
# yarn运行项目
yarn serve
```

## 使用 create-vite 创建项目

```bash
# npm
npm init vite
# yarn
yarn create vite
```

这跟 vue-cli 有了明显区别，不需要安装全局的脚手架命令

原理在于：npm init \<initializer> 命令创建一个新的或者已经存在的 npm 包，initializer 表示名为 create-\<initializer> 的 npm 包，将使用 npx 安装，然后执行其 package.json 中 bin 属性对应的脚本，所以该命令实际上是使用 npx 运行 [create-vite](https://www.npmjs.com/package/create-vite) 这个 npm 包，从而下载模板

官方说明也给出了命令相对应的一些示例：

| 命令              | 等同                |
| ----------------- | ------------------- |
| npm init foo      | npx create-foo      |
| npm init @usr     | npx @usr/create     |
| npm init @usr/foo | npx @usr/create-foo |

> 另外，取自 [create-vite](https://www.npmjs.com/package/create-vite) 官方文档：

> 兼容性说明: Vite 要求 Node.js 版本 >=12.2.0，一些模板的正常使用还需要更高的 Node.js 版本, 所以如果您在 node 使用过程中产生了相应警告，请升级

直接创建模板

```bash
# npm 6.x
npm create vite vue-project-name --template vue
# npm 7+, extra double-dash is needed:
npm create vite vue-project-name -- --template vue
# yarn
yarn create vite vue-project-name --template vue
# pnpm
pnpm create vite vue-project-name -- --template vue
```

```bash
# npm 6.x
npm create vite vue-project-name --template vue-ts
# npm 7+, extra double-dash is needed:
npm create vite vue-project-name -- --template vue-ts
# yarn
yarn create vite vue-project-name --template vue-ts
# pnpm
pnpm create vite vue-project-name -- --template vue-ts
```

并且跟 vue-cli 不同的，需要进入目录后自行下载依赖

```bash
# 进入项目目录
cd vue-project-name
# 使用vscode打开项目
code ./
# yarn
yarn
# 运行项目
npm run dev
```

## 安装 vue devtools 谷歌插件

[vue devtools](https://chrome.zzzmh.cn/info?token=nhdogjmejiglipccpnnnanhbledajbpd) 用于开发 vue 项目时进行调试

> 使用极速插件网(一个快速安装下载谷歌浏览器插件的网站)进行下载安装

下载完成后如何安装插件：

1. 打开谷歌浏览器

2. 点击右上角三个点

3. 选择更多工具

4. 选择拓展程序

5. 打开开发者模式

6. 拖拽解压后的插件至浏览器中

## vue-router

### 下载使用

```bash
#@next表示下载最新版
npm i vue-router@next -s
```

src 下新建 router 文件夹，新建 index.ts

```typescript
import { createRouter, createWebHistory, RouteRecordRaw } from 'vue-router'

const routes: Array<RouteRecordRaw> = [
  {
    path: '/',
    name: 'home',
    component: () => import('../views/Home.vue')
  }
]
const router = createRouter({
  history: createWebHistory(),
  routes
})

export default router
```

main.ts 中加入

```js
import router from './router'
app.use(router)
```

### 传参

- $router 是路由操作对象，只写对象
- $route 路由信息对象，只读对象
- name 可以使用 query 和 params 传参
- path 不能使用 params 传参，只能使用 query 传参

- query 相当于 get 请求，页面跳转的时候，可以在地址栏看到请求参数，刷新后依旧存在
- params 相当于 post 请求，参数不会再地址栏中显示，刷新后不复存在

```js
this.$router.push({ path: 'world', query: { id: 'id' } })
this.$router.push({ name: 'world', params: { id: 'id' } })
```

接收

```js
this.$route.query
this.$route.params
```

### 路由占位符

声明接收 params 参数，如果不传递 params 或传递 params 为空，都会直接报错，Uncaught Error: Missing required param "code"

```js
 {
    path: "/:code",
    name: "home",
    component: () => import(/* webpackChunkName: "about" */ "../views/Home.vue")
  }
```

```js
router.push({ name: 'home', query: { k: 1 } })
// Uncaught Error: Missing required param "code"
router.push({ name: 'home', params: { code: '' }, query: { k: 2 } })
// Uncaught Error: Missing required param "code"
```

如果希望 params 参数是可选传递，可传可不传,在占位符后面加个？号即可

```js
 {
    path: "/:code?",
    name: "home",
    component: () => import(/* webpackChunkName: "about" */ "../views/Home.vue")
  }
```

### 路由传递 props 的三种写法

路由跳转

```typescript
<script lang="ts" setup>
  import {useRouter} from "vue-router" const router = useRouter() function
  goSearch(){' '}
  {router.push({ name: 'home', params: { code: '111' }, query: { key: 222 } })}
</script>
```

#### 布尔值

```js
{
    path: "/:code",
    name: "home",
    component: () => import("../views/Home.vue"),
    props:true // 会将params传递至该组件中
}
```

组件中正常使用 props 接收即可

```typescript
<script lang="ts" setup>
import { defineProps } from "vue"
const props = defineProps<{
  code: string
}>()
</script>
```

#### 对象

```js
{
    path: "/:code",
    name: "home",
    component: () => import("../views/Home.vue"),
    props: { a: 1, b: 2 }
}
```

```typescript
<script lang="ts" setup>
import { defineProps } from "vue"
const props = defineProps<{
  a: number
  b: number
}>()
</script>
```

#### 函数

```js
{
    path: "/:code",
    name: "home",
    component: () => import("../views/Home.vue"),
    props: $router => {
      return { a: $router.params.code, b: $router.query.key }
    }
}
```

```typescript
<script lang="ts" setup>
import { defineProps } from "vue"
const props = defineProps<{
  a: string
  b: number
}>()
</script>
```

### router-view

router-view 是路由的占位标签，会根据当前路径将该位置替换为该路径相匹配的 vue 组件

父组件中使用 router-view，会根据子组件的路由自动匹配显示相应内容

router-view 父子组件通信

父组件

父组件传递给子组件一个方法 getTitle

```js
<router-view :hdId="hdidArr" @getTitle="showtitle" />
```

子组件

子组件通过 getTitle 这个方法传值

```js
this.$emit('getTitle', this.$route.query.tit)
```

e 即是子组件传过来的值

父组件通过传递给子组件方法 getTitle 绑定的方法 showtitle 进行接收

```js
 showtitle (e) {
            this.$message.success(e)
        }
```

element-plus 中 el-menu 内置 vue-route，设置 router 属性为 true 后，el-menu-item 中可以使用 index 属性进行路径跳转，使用 route 属性进行路径传参

```vue
<el-menu-item
  v-for="item in items"
  :key="item.id"
  :index="item.url"
  :route="{ path: item.url, query: { name: item.id } }"
>
</el-menu-item>
```

## vite 中图片路径

需要使用 vite 特定的文件系统，main.ts 中定义相应全局函数

```typescript
const app = createApp(App)
app.config.globalProperties.getSrc = (name: string) => {
  const path = `/src/assets/images/${name}.svg`
  const modules = import.meta.globEager('/src/assets/images/*.svg')
  return modules[path].default
}
```

vue 组件中直接使用

```html
<img :src="!areaActive?requireImg('capacity-active.svg'):requireImg('capacity.svg')"/>
```

## unplugin-auto-import

vite插件，自动导入 composition api

```sh
yarn add -D unplugin-auto-import
```

vite.config.ts配置如下

```typescript
import AutoImport from 'unplugin-auto-import/vite'
export default defineConfig({
  plugins: [
    ...
    AutoImport({
      imports: ['vue', 'vue-router'], // 自动导入vue相关函数
      dts: 'src/auto-import.d.ts' // 生成 `auto-import.d.ts` 全局声明
    })
  ]
})
```



## unplugin-vue-components

vite插件，自动注册和导入组件，默认自动导入 src/components 目录下组件

```bash
yarn add -D unplugin-vue-components
```

## vite-plugin-pages

读取文件夹下所有 vue 组件，自动生成路由信息

```bash
yarn add -D vite-plugin-pages
yarn add vue-router@next
```

```typescript
import routes from 'virtual:generated-pages'
const router = createRouter({
  history: createWebHashHistory(),
  routes
})
createApp(App).use(router).mount('#app')
```

d.ts 中加入 type 支持

```typescript
/// <reference types="vite-plugin-pages/client" />
```

## vite-plugin-md

```bash
yarn add -D vite-plugin-md
```

自动注册 md 文件为 vue 组件

## prism-theme-vars

```bash
yarn add prism-theme-vars
```

prism 主题变量

新建 style.css,在 main.js 中导入

## vite.config.ts

```typescript
import { defineConfig } from 'vite'
import Vue from '@vitejs/plugin-vue'
import Markdown from 'vite-plugin-md'
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'
import Prism from 'markdown-it-prism'
import Pages from 'vite-plugin-pages'

export default defineConfig({
  plugins: [
    Vue({
      include: [/\.vue$/, /\.md$/] // 识别vue组件
    }),
    // 自动读取src/views下目录生成路由信息
    Pages({
      dirs: [{ dir: 'src/views', baseRoute: '/' }], // 根目录src/views
      importMode: 'async', // 异步方式导入组件
      // 实现redirect
      extendRoute(route) {
        if (route.path === '/') return { ...route, redirect: 'a' }
      }
    }),
    // 实现markdown支持和prism代码块高亮
    Markdown({
      markdownItSetup(md) {
        md.use(Prism)
      }
    }),
    Components({
      dirs: ['src/components'], // 要搜索组件的目录的相对路径
      deep: true, // 搜索子目录
      extensions: ['vue', 'md'], // 组件的有效文件扩展名
      dts: 'src/components/components.d.ts' // 生成 `components.d.ts` 全局声明
    }),
    AutoImport({
      imports: ['vue', 'vue-router'], // 自动导入vue相关函数
      dts: 'src/auto-import.d.ts' // 生成 `auto-import.d.ts` 全局声明
    })
  ]
})
```
