# create-vite 创建项目

## 安装

```bash
# npm
npm init vite
# yarn
yarn create vite
```

这跟@vue-cli 有了明显区别，不需要安装全局的脚手架命令

原理在于：npm init \<initializer>命令将使用 npx 安装名为 create-\<initializer> 的 npm 包，将，然后执行其 package.json 中 bin 属性对应的脚本，所以该命令实际上是使用 npx 运行 [create-vite](https://www.npmjs.com/package/create-vite) 这个 npm 包，从而下载vite项目模板

npm init 命令相对应的一些示例：

| 命令              | 等同                |
| ----------------- | ------------------- |
| npm init foo      | npx create-foo      |
| npm init @usr     | npx @usr/create     |
| npm init @usr/foo | npx @usr/create-foo |

> 另外，取自 [create-vite](https://www.npmjs.com/package/create-vite) 官方文档：

> 兼容性说明: Vite 要求 Node.js 版本 >=12.2.0，一些模板的正常使用还需要更高的 Node.js 版本, 所以如果您在 node 使用过程中产生了相应警告，请升级

直接创建模板

```bash
# npm 6.x
npm create vite vue-project-name --template vue
# npm 7+, extra double-dash is needed:
npm create vite vue-project-name -- --template vue
# yarn
yarn create vite vue-project-name --template vue
# pnpm
pnpm create vite vue-project-name -- --template vue
```

```bash
# npm 6.x
npm create vite vue-project-name --template vue-ts
# npm 7+, extra double-dash is needed:
npm create vite vue-project-name -- --template vue-ts
# yarn
yarn create vite vue-project-name --template vue-ts
# pnpm
pnpm create vite vue-project-name -- --template vue-ts
```

并且跟 vue-cli 不同的，需要进入目录后自行下载依赖

```bash
# 进入项目目录
cd vue-project-name
# 使用vscode打开项目
code ./
# yarn
yarn
# 运行项目
npm run dev
```

## vite 中图片路径

### 1.使用src开头的路径

```html
<img src="src/assets/img"/>
```

## 2.使用 vite 特定的文件系统

main.ts 中定义相应全局函数

```typescript
const app = createApp(App)
app.config.globalProperties.getSrc = (name: string) => {
  const path = `/src/assets/images/${name}.svg`
  const modules = import.meta.globEager('/src/assets/images/*.svg')
  return modules[path].default
}
```

vue 组件中直接使用

```html
<img :src="!areaActive?requireImg('capacity-active.svg'):requireImg('capacity.svg')"/>
```

## unplugin-auto-import

vite插件，可用于自动导入 composition api, 而无需再手动引入

```sh
yarn add -D unplugin-auto-import
```

vite.config.ts配置如下

```ts
import AutoImport from 'unplugin-auto-import/vite'
export default defineConfig({
  plugins: [
    ...
    AutoImport({
      imports: ['vue', 'vue-router'], // 自动导入vue相关函数
      dts: 'src/auto-import.d.ts' // 生成 `auto-import.d.ts` 全局声明
    })
  ]
})
```

## unplugin-vue-components

vite插件，自动注册和导入组件，默认自动导入 src/components 目录下组件

```sh
yarn add -D unplugin-vue-components
```

vite.config.ts配置如下

```ts
import Components from 'unplugin-vue-components/vite'
export default defineConfig({
  plugins: [
    ...
    Components({
      dirs: ['src/components'], // 要搜索组件的目录的相对路径
      deep: true, // 搜索子目录
      extensions: ['vue', 'md'], // 组件的有效文件扩展名
      dts: 'src/components/components.d.ts' // 生成 `components.d.ts` 全局声明
    })
  ]
})
```

## vite-plugin-pages

读取文件夹下所有 vue 组件，自动生成路由信息

```bash
yarn add -D vite-plugin-pages
yarn add vue-router@next
```

```typescript
import routes from 'virtual:generated-pages'
const router = createRouter({
  history: createWebHashHistory(),
  routes
})
createApp(App).use(router).mount('#app')
```

d.ts 中加入 type 支持

```typescript
/// <reference types="vite-plugin-pages/client" />
```

## vite-plugin-md

```sh
yarn add -D vite-plugin-md
```

自动注册 md 文件为 vue 组件

## prism-theme-vars

```sh
yarn add prism-theme-vars
```

prism 主题变量

新建 style.css,在 main.js 中导入

## vite.config.ts

```ts
import { defineConfig } from 'vite'
import Vue from '@vitejs/plugin-vue'
import Markdown from 'vite-plugin-md'
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'
import Prism from 'markdown-it-prism'
import Pages from 'vite-plugin-pages'

export default defineConfig({
  plugins: [
    Vue({
      include: [/\.vue$/, /\.md$/] // 识别vue组件
    }),
    // 自动读取src/views下目录生成路由信息
    Pages({
      dirs: [{ dir: 'src/views', baseRoute: '/' }], // 根目录src/views
      importMode: 'async', // 异步方式导入组件
      // 实现redirect
      extendRoute(route) {
        if (route.path === '/') return { ...route, redirect: 'a' }
      }
    }),
    // 实现markdown支持和prism代码块高亮
    Markdown({
      markdownItSetup(md) {
        md.use(Prism)
      }
    }),
    Components({
      dirs: ['src/components'], // 要搜索组件的目录的相对路径
      deep: true, // 搜索子目录
      extensions: ['vue', 'md'], // 组件的有效文件扩展名
      dts: 'src/components/components.d.ts' // 生成 `components.d.ts` 全局声明
    }),
    AutoImport({
      imports: ['vue', 'vue-router'], // 自动导入vue相关函数
      dts: 'src/auto-import.d.ts' // 生成 `auto-import.d.ts` 全局声明
    })
  ]
})
```
