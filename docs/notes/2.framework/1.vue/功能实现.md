# 功能实现

## 前端人脸识别

```html
<!-- 人脸识别 -->
<template>
  <!-- v-show="faceSure" -->
  <!-- :class="faceSure?'':'hideFalse'" -->
  <div class="entryFace  selfTestTracking" v-if="face">
    <div class="bgNo" :class="isBg ? 'bg' : ''">
      <div class="title">请将面部对准识别区域</div>
      <div class="ts">
        提示：在采集面人脸时摘掉口罩、帽子等遮挡面部的物品会使识别率更高。
      </div>
    </div>
    <video
      id="videoCamera"
      width="1920"
      height="1080"
      preload
      autoplay
      loop
      muted
      x5-video-player-type="h5-page"
    ></video>
    <canvas id="canvas" ref="canvas" width="1920" height="1080"></canvas>
    <canvas
      id="canvas-face"
      width="1920"
      height="1080"
      style="display: none;"
    ></canvas>
    <div class="bottom" v-show="showBtn">
      <div class="left-btn" @click="exit">返回</div>
    </div>
  </div>
</template>

<script>
  function dataURLtoFile(dataurl, filename) {
    //将base64转换为文件
    var arr = dataurl.split(','),
      mime = arr[0].match(/:(.*?);/)[1],
      bstr = atob(arr[1]),
      n = bstr.length,
      u8arr = new Uint8Array(n)
    while (n--) {
      u8arr[n] = bstr.charCodeAt(n)
    }
    return new File([u8arr], filename, {
      type: mime
    })
  }
  import tracking from '@/assets/js/ytjTracking.js'
  import '@/assets/js/face-min.js'
  import axios from 'axios'
  import { updateFace } from '@/util/api.js'
  import { Toast } from 'vant'
  export default {
    name: 'testTracking',
    data() {
      return {
        trackerTask: null,
        trackering: null,
        mediaStreamTrack: null,
        faceSure: false,
        loading: false,
        clientWidth: '',
        clientHeight: '',
        offsetY: '',
        offsetX: '',
        change: '',
        videoIdArr: [],
        isBg: false,
        userInfo: {},
        showBtn: false
      }
    },
    props: {
      face: Boolean
    },
    mounted() {
      // 获取用户信息
      this.userInfo = JSON.parse(localStorage.getItem('UserInfo'))
      console.log('config.videoId:' + config.videoId)
      this.getCompetence(config.videoId)
    },
    methods: {
      exit() {
        console.log('关闭了啊')
        this.mediaStreamTrack.srcObject.getTracks()[0].stop() // 关闭摄像头
        this.trackerTask.stop() // 停止侦测
        this.$parent.exit()
      },
      getCompetence(videoId) {
        let flag = true
        const _this = this
        const video = (this.mediaStreamTrack =
          document.getElementById('videoCamera'))
        const canvasUpload = document.getElementById('canvas-face')
        const contextUpload = canvasUpload.getContext('2d')
        const tracker = new window.tracking.ObjectTracker('face')
        contextUpload.translate(1920, 0)
        contextUpload.scale(-1, 1)
        tracker.setInitialScale(4)
        tracker.setStepSize(2)
        tracker.setEdgesDensity(0.1)
        // 启动摄像头初始化
        this.trackerTask = window.tracking.track(
          '#videoCamera',
          tracker,
          {
            camera: true
          },
          1920,
          1080,
          videoId
        )

        tracker.on('track', function (event) {
          _this.showBtn = true
          if (event.data.length) {
            // 会不停的去检测人脸，所以这里需要做个锁
            if (flag) {
              // 裁剪出人脸并绘制
              // contextUpload.clearRect(0, 0, 1920, 1080);
              contextUpload.drawImage(video, 0, 0, 1920, 1080)
              // contextUpload.drawImage(video,690,235,1230,700,1230,0,1230,700);
              // contextUpload.drawImage(video,690,235,1230,700,1230,0,1230,700);
              flag = false
              // 人脸的basa64
              const dataURL = canvasUpload.toDataURL('image/jpeg')
              console.log(dataURL)
              // img文件
              var cc = dataURLtoFile(dataURL, 'name.png')
              // 获取FormData对象
              let fd = new FormData()
              // 将图片传入formdata
              fd.append('file', cc)
              axios
                .post(process.env.VUE_APP_URL + 'common/upload', fd, {
                  headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                  }
                })
                .then((res) => {
                  _this.userInfo.headImgPath = res.data.data[0].fileUrl
                  if (res.data.status == 200) {
                    // 上传人脸
                    updateFace('post', _this.userInfo).then((res1) => {
                      if (res1.data.status == 200) {
                        console.log('关闭了啊')
                        // 关闭摄像头
                        _this.mediaStreamTrack.srcObject.getTracks()[0].stop()
                        // 停止侦测
                        _this.trackerTask.stop()
                        // console.log(res.data.data[0].fileUrl)
                        _this.$parent.acquisitionSuccess(
                          res.data.data[0].fileUrl
                        )
                      } else {
                        Toast(res1.data.msg)
                        setTimeout(() => {
                          flag = true
                          console.log('关闭了啊')
                          // 关闭摄像头
                          _this.mediaStreamTrack.srcObject.getTracks()[0].stop()
                          // 停止侦测
                          _this.trackerTask.stop()
                          _this.$parent.exit()
                        }, 3000)
                      }
                    })
                  } else {
                    Toast(res.data.message)
                  }
                  // this.imgUrlListValue.push(res.data.urls[0].image) //这里上传到指定的图片服务器，成功后会返回图片的url
                })
                .catch((err) => {})
            }
          }
        })
      }
    },
    destroyed() {
      console.log('关闭了啊')
      // 关闭摄像头
      this.mediaStreamTrack.srcObject.getTracks()[0].stop()
      // 停止侦测
      this.trackerTask.stop()
      const canvasUpload = document.getElementById('canvas-face')
      const contextUpload = canvasUpload.getContext('2d')
      // contextUpload.clearRect(0, 0, this.clientWidth, this.clientHeight);
    }
  }
</script>

<style lang="less" scoped>
  @rem: 192;
  .hideFalse {
    visibility: hidden;
  }
  .bgNo {
    background: url('../assets/imgs/selfService/faceBg.png') no-repeat;
    background-size: 100% 100%;
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0px;
    left: 0px;
    z-index: 99;
    .title {
      font-size: unit(60 / @rem, rem);
      text-align: center;
      color: #333;
      margin-top: unit(64 / @rem, rem);
    }
    .ts {
      font-size: unit(36 / @rem, rem);
      text-align: center;
      color: #f99501;
      margin-top: unit(24 / @rem, rem);
    }
  }
  .bg {
    background: url('../assets/imgs/selfService/faceBgScuess.png') no-repeat;
    background-size: 100% 100%;
  }
  .entryFace {
    width: 100%;
    height: 100vh;
    margin: 0px auto;
    position: fixed;
    top: unit(0 / @rem, rem);
    left: unit(0 / @rem, rem);
    background: #000;
    z-index: 999;
    #canvas {
      display: block;
      position: absolute;
      top: 0px;
      left: 0px;
      z-index: 99;
    }

    #videoCamera {
      display: block;
      position: absolute;
      top: 0px;
      left: 0px;
      background: none;
      transform: rotateY(180deg);
    }

    #canvas-face {
      position: absolute;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 100%;
    }

    .loadingBox {
      background-color: rgba(0, 0, 0, 0.8);
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: unit(20 / @rem, rem) unit(40 / @rem, rem);
      border-radius: unit(10 / @rem, rem);
    }

    button {
      position: absolute;
      top: 20px;
      left: 20px;
    }

    .bottom {
      position: absolute;
      bottom: unit(60 / @rem, rem);
      left: unit(80 / @rem, rem);
      width: unit(1760 / @rem, rem);
      z-index: 99999;
      overflow: hidden;
      .left-btn {
        float: left;
        width: unit(320 / @rem, rem);
        height: unit(80 / @rem, rem);
        background: #d1440d;
        text-align: center;
        line-height: unit(80 / @rem, rem);
        color: #e18e74;
        font-size: unit(48 / @rem, rem);
        font-weight: bold;
        border-radius: unit(20 / @rem, rem);
      }
      .right-btn {
        float: right;
        width: unit(320 / @rem, rem);
        height: unit(80 / @rem, rem);
        text-align: center;
        line-height: unit(80 / @rem, rem);
        color: #fff;
        font-size: unit(48 / @rem, rem);
        font-weight: bold;
        background: #f2ae0d;
        border-radius: unit(20 / @rem, rem);
      }
    }
  }
</style>
```

## 签字版

```js
<template>
  <div class="drop" :class="signature ? '' : 'hide'">
    <div class="signature-box" v-if="showSignatureArea">
      <p class="hint">温馨提示：请填写核对确认信息无误后，在下方手写区域签名，并提交申请。</p>
      <div class="canvas-box" id="canvasBox">
        <canvas id="canvas"></canvas>
        <span>签字区</span>
      </div>
      <div class="canvas-btn-group">
        <div class="btn close" @click="hideSignature">返回检查</div>
        <div class="btn rewriting" @click="clear"><img src="../assets/imgs/selfService/u1398.png" />清除重写</div>
        <div class="btn submit" @click="submit">提交申请</div>
      </div>
    </div>
    <!-- 退役报道显现-->
    <div class="tips" v-show="isSuccess && Ddata.type == 1">
      <img class="icon" src="@/assets/imgs/selfService/success.png" alt />
      <div class="tit">提交成功！</div>
      <p class="txt">尊敬的战友：{{ name }}</p>
      <p class="txt">您好！</p>
      <p class="txt indx">
        您的【信息采集】材料已经提交成功，我们会在24⼩时内进⾏审核，审核通过后会第⼀时间通知到您，
        <span class="g">请保持⼿机畅通！</span>如有疑问可以拨打退役军⼈服务中⼼电话： <span class="y">{{ ServiceTelephone }}</span
        >进⾏咨询。
      </p>
      <p class="txt">我们会竭诚为您服务，欢迎回家！</p>
      <p class="txt right">{{ title }}退役军⼈事务局</p>
      <div class="btn" @click="ok">确认</div>
    </div>
    <!--诉求服务显示-->
    <div class="tips" v-show="isSuccess && Ddata.type == 2">
      <img class="icon" src="@/assets/imgs/selfService/success.png" alt />
      <div class="tit">提交成功！</div>
      <p class="txt">尊敬的战友：{{ name }}</p>
      <p class="txt">您好！</p>
      <p class="txt indx">
        您的【诉求服务】材料已经提交成功，我们会在48⼩时进⾏回复，
        <span class="g">请保持⼿机畅通！</span>如有疑问可以拨打退役军⼈服务中⼼电话： <span class="y">{{ ServiceTelephone }}</span
        >进⾏咨询。
      </p>
      <p class="txt">我们会竭诚为您服务，保障每个退役军⼈合理合规诉求，让崇⾼落地！</p>
      <p class="txt right">{{ title }}退役军⼈事务局</p>
      <div class="btn" @click="ok">确认</div>
    </div>
    <!-- 教育培训显示-->
    <div class="train-tip" v-show="isSuccess && Ddata.type == 3">
      <img class="icon" src="@/assets/imgs/selfService/success.png" />
      <div class="tit">提交成功！</div>
      <p class="txt">
        请近期随时关注您的
        <span class="orange">手机信息</span>
      </p>
      <p class="txt">我们会在信息材料审核结束后通知您审核结果</p>
      <div class="btn" @click="ok">确认</div>
    </div>
    <div class="father">
      <div class="son">
        <div class="grandson"></div>
      </div>
    </div>
    <!-- 审核类业务显示-->
    <div class="tips" v-show="isSuccess && Ddata.type != 1 && Ddata.type != 2 && Ddata.type != 3">
      <img class="icon" src="@/assets/imgs/selfService/success.png" alt />
      <div class="tit">提交成功！</div>
      <p class="txt">尊敬的战友：{{ name }}</p>
      <p class="txt">您好！</p>
      <p class="txt indx">
        您的材料已经提交成功，我们会在24⼩时内进⾏审核，审核通过后会第⼀时间通知到您， <span class="g">请保持⼿机畅通！</span>如有疑问可以拨打退役军⼈服务中⼼电话： <span class="y">{{ ServiceTelephone }}</span
        >进⾏咨询。
      </p>
      <p class="txt">我们会竭诚为您服务！</p>
      <p class="txt right">{{ title }}退役军⼈事务局</p>
      <div class="btn" @click="ok">确认</div>
    </div>
  </div>
</template>

<script>
import {saveInfo, educationTrainAdd} from "@/util/api.js"
import axios from "axios"
let isSubmit = false // 是否签字
class Draw {
  constructor() {
    const box = document.getElementById("canvasBox") // 获取父元素
    this.clientWidth = box.clientWidth // 获取父元素宽
    this.clientHeight = box.clientHeight // 获取父元素高
    this.canvas = document.getElementById("canvas") // 获取canvas元素
    this.Top = this.canvas.getBoundingClientRect().top // 这里父元素是相对定位，所以不能使用offsetTop和offsetLeft
    this.Left = this.canvas.getBoundingClientRect().left // 而getBoundingClientRect只相对于可见窗口，可以使用
    this.canvas.setAttribute("width", this.clientWidth) // 设置canvas为父元素canvasBox宽度
    this.canvas.setAttribute("height", this.clientHeight) // 设置canvas为父元素canvasBox高度
    this.cxt = this.canvas.getContext("2d") // 获取canvas实例
  }
  init() {
    this.canvas.addEventListener("touchstart", event => {
      this.drawBegin(event)
    })
    this.canvas.addEventListener("touchend", () => {
      this.drawEnd()
    })
    this.clear() // 清空上一次签字
  }
  // 触发签字事件
  drawBegin(e) {
    this.cxt.strokeStyle = "#000"
    this.cxt.beginPath() // 起始一条路径，或重置当前路径
    this.cxt.moveTo(e.changedTouches[0].clientX - this.Left, e.changedTouches[0].clientY - this.Top)
    this.canvas.addEventListener("touchmove", event => {
      this.drawing(event)
    })
  }
  // 滑动签字
  drawing(e) {
    this.cxt.lineTo(e.changedTouches[0].clientX - this.Left, e.changedTouches[0].clientY - this.Top) // 添加一个新点，然后在画布中创建从该点到最后指定点的线条
    this.cxt.stroke() // 绘制已定义的路径
  }
  // 结束滑动
  drawEnd() {
    isSubmit = true
  }
  // 清空签字
  clear() {
    isSubmit = false
    this.cxt.clearRect(0, 0, this.clientWidth, this.clientHeight)
  }
  // 保存canvas为图片
  save() {
    return this.canvas.toDataURL("image/png") // toDataURL用于将canvas对象转换为base64位编码
  }
}

export default {
  props: {
    signature: Boolean, // 是否显示当前组件
    Ddata: Object // 当前模块用户填写信息
  },
  data() {
    return {
      title: "", // 市局名
      ServiceTelephone: "", // 市局联系电话
      type: "", // 判断哪个模块调用签字组件
      name: "", // 用户姓名
      isSubmit: false, // 是否已签字
      isSuccess: false, // 控制显示成功提交的弹窗显示
      showSignatureArea: true // 控制签名区显示
    }
  },
  mounted() {
    this.draw = new Draw("canvas") // 实例Draw类
    this.draw.init() // 初始化
    this.title = config.title // 获取config.js里的市局名
    this.ServiceTelephone = config.ServiceTelephone // 获取config.js里的服务电话
    this.type = sessionStorage.getItem("type") // 判断哪个模块调用签字组件
    this.name = JSON.parse(localStorage.getItem("UserInfo")).name // 用户姓名
  },
  methods: {
    // 点击返回检查,调用父级方法关闭签字区域
    hideSignature() {
      this.$parent.hideSignature()
    },
    // 点击清除重写,清空签字区
    clear() {
      this.draw.clear()
    },
    //将base64转换为文件
    dataURLtoFile(dataurl, filename) {
      var arr = dataurl.split(","),
        mime = arr[0].match(/:(.*?);/)[1],
        bstr = atob(arr[1]),
        n = bstr.length,
        u8arr = new Uint8Array(n)
      while (n--) {
        u8arr[n] = bstr.charCodeAt(n)
      }
      return new File([u8arr], filename, {
        type: mime
      })
    },
    // 点击提交申请->上传签名图片->保存所有信息
    async submit() {
      if (!isSubmit) return this.$Toast("请签名")
      const img = this.draw.save() // 保存成base64 图片格式
      const cc = this.dataURLtoFile(img, "name.png") // 将base64转换为文件
      const fd = new FormData() // new一个FormData对象
      fd.append("file", cc) // 将图片传入Formdata
      const {data: res} = await axios.post(process.env.VUE_APP_URL + "common/upload", fd, {headers: {"Content-Type": "application/x-www-form-urlencoded"}})
      if (res.status == 200) {
        // 上传签名成功
        this.Ddata.jdRetireInfo.signUrl = res.data[0].fileUrl // 上传后的签名地址存到jdRetireInfo中
        this.Ddata.jdRetireInfo.checkStatus = 2 // 0未提交材料 1已提交材料未签名 2已签名 3审核通过 4审核未通过
        if (this.type == "TRAIN_TYPE") {
          // 教育培训模块保存信息
          educationTrainAdd("post", this.Ddata, "json").then(res => {
            if (res.data.status == 200) {
              this.showSignatureArea = false // 关闭签名区
              this.isSuccess = true // 显示成功提交弹窗
            }
          })
        } else {
          // 其他模块保存信息
          saveInfo(this.type, this.Ddata, "json").then(res1 => {
            if (res1.data.status == 200) {
              this.showSignatureArea = false // 关闭签名区
              this.isSuccess = true // 显示成功提交弹窗
            }
          })
        }
      } else {
        // 上传签名不成功的错误信息
        this.$Toast(res.data.message)
      }
    },
    // 提交成功后点击确认回到首页
    ok() {
      this.$parent.hideSignature()
      this.$router.push({name: "selfHome"})
    }
  }
}
</script>

<style lang="less">
@rem: 192;

.hide {
  visibility: hidden;
}

.drop {
  width: 100vw;
  height: 100vh;
  position: fixed;
  top: unit(0 / @rem, rem);
  left: unit(0 / @rem, rem);
  background: rgba(0, 0, 0, 0.5);
  z-index: 999;
  .signature-box {
    width: unit(1100 / @rem, rem);
    height: unit(700 / @rem, rem);
    background: #f2f2f2;
    border-radius: unit(10 / @rem, rem);
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: unit(0 / @rem, rem) unit(50 / @rem, rem);
    padding-top: unit(33 / @rem, rem);
    box-sizing: border-box;

    .hint {
      color: #f99501;
      font-weight: 700;
      font-size: unit(18 / @rem, rem);
      text-align: center;
      margin-bottom: unit(38 / @rem, rem);
    }

    .canvas-box {
      height: unit(460 / @rem, rem);
      border: unit(1 / @rem, rem) solid #797979;
      background: #fff;
      margin-top: unit(15 / @rem, rem);
      position: relative;

      #canvas {
        position: absolute;
        top: 0px;
        left: 0px;
      }

      span {
        font-size: unit(72 / @rem, rem);
        color: #cccccc;
        display: block;
        text-align: center;
        line-height: unit(460 / @rem, rem);
        position: absolute;
        top: unit(0 / @rem, rem);
        left: unit(0 / @rem, rem);
        z-index: 1;
        display: block;
        width: 100%;
      }
    }

    .canvas-btn-group {
      display: flex;
      justify-content: space-between;
      margin-top: unit(40 / @rem, rem);

      .btn {
        width: unit(260 / @rem, rem);
        height: unit(60 / @rem, rem);
        border-radius: unit(10 / @rem, rem);
        font-size: unit(30 / @rem, rem);
        font-weight: bold;
        text-align: center;
        line-height: unit(60 / @rem, rem);
        box-sizing: border-box;
      }

      .close {
        background: #fff;
        color: #f99501;
        box-shadow: 0px 0px unit(13 / @rem, rem) unit(3 / @rem, rem) rgba(62, 31, 32, 0.08);
      }

      .rewriting {
        background: #fff;
        color: #f99501;
        border: unit(3 / @rem, rem) solid #f99501;
        line-height: unit(54 / @rem, rem);
        img {
          width: unit(29 / @rem, rem);
          height: unit(31 / @rem, rem);
          position: relative;
          top: unit(7 / @rem, rem);
          margin-right: unit(13 / @rem, rem);
        }
      }

      .submit {
        background: #f99501;
        color: #fff;
        box-shadow: 0px 0px unit(13 / @rem, rem) unit(3 / @rem, rem) rgba(62, 31, 32, 0.08);
      }
    }
  }
}

.tips {
  width: unit(1226 / @rem, rem);
  height: unit(772 / @rem, rem);
  background: #fff;
  border-radius: unit(24 / @rem, rem);
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: unit(66 / @rem, rem) unit(171 / @rem, rem) unit(48 / @rem, rem) unit(171 / @rem, rem);
  box-sizing: border-box;
  .icon {
    width: unit(377 / @rem, rem);
    height: unit(237 / @rem, rem);
    display: block;
    margin: 0px auto;
  }
  .tit {
    color: #333333;
    font-size: unit(40 / @rem, rem);
    font-weight: bold;
    text-align: center;
    margin-bottom: unit(24 / @rem, rem);
    margin-top: unit(24 / @rem, rem);
  }
  .txt {
    color: #333333;
    font-size: unit(24 / @rem, rem);
    line-height: unit(36 / @rem, rem);
    font-weight: bold;
    text-align: justify;
  }
  .indx {
    text-indent: unit(48 / @rem, rem);
  }
  .g {
    color: #3bba67;
  }
  .y {
    color: #f99501;
  }
  .right {
    text-align: right;
  }
  .btn {
    width: unit(260 / @rem, rem);
    height: unit(60 / @rem, rem);
    background: #f99501;
    box-shadow: 0px 0px unit(13 / @rem, rem) unit(3 / @rem, rem) rgba(62, 31, 32, 0.15);
    border-radius: unit(10 / @rem, rem);
    text-align: center;
    line-height: unit(60 / @rem, rem);
    color: #fff;
    font-size: unit(30 / @rem, rem);
    margin: 0px auto;
    margin-top: unit(37 / @rem, rem);
  }
}

.train-tip {
  width: unit(750 / @rem, rem);
  height: unit(520 / @rem, rem);
  background: #fff;
  border-radius: unit(24 / @rem, rem);
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  box-sizing: border-box;
  .icon {
    width: unit(277 / @rem, rem);
    height: unit(177 / @rem, rem);
    display: block;
    margin: 0px auto;
    margin-top: unit(54 / @rem, rem);
  }
  .tit {
    color: #333333;
    font-size: unit(36 / @rem, rem);
    font-weight: bold;
    text-align: center;
    padding-left: unit(45 / @rem, rem);
    letter-spacing: unit(5 / @rem, rem);
    margin-bottom: unit(18 / @rem, rem);
    margin-top: unit(10 / @rem, rem);
  }
  .txt {
    color: #333333;
    padding-left: unit(5 / @rem, rem);
    letter-spacing: unit(2 / @rem, rem);
    font-size: unit(24 / @rem, rem);
    font-weight: bold;
    text-align: center;
    margin-bottom: unit(4 / @rem, rem);
    .orange {
      color: #f99501;
    }
  }
  .btn {
    width: unit(260 / @rem, rem);
    height: unit(60 / @rem, rem);
    background: #f99501;
    padding-left: unit(5 / @rem, rem);
    letter-spacing: unit(5 / @rem, rem);
    box-shadow: 0px 0px unit(13 / @rem, rem) unit(3 / @rem, rem) rgba(62, 31, 32, 0.15);
    border-radius: unit(10 / @rem, rem);
    text-align: center;
    line-height: unit(60 / @rem, rem);
    color: #fff;
    font-size: unit(30 / @rem, rem);
    margin: 0px auto;
    margin-top: unit(37 / @rem, rem);
  }
}
</style>
```

## 鼠标移动增加删除

```js
<template>
  <div class="flex" style="display:flex">
    <div class="options">
      <div @mousedown.prevent="move('英语')">英语</div>
      <div @mousedown.prevent="move('数学')">数学</div>
      <div @mousedown.prevent="move('语文')">语文</div>
      <div @mousedown.prevent="move('暂定')">暂定</div>
      <div class="mouse" ref="mouse">{{mouseText}}</div>
    </div>
    <div class="new" style="margin-left:100px">
      <h1 @mouseup="add">科目</h1>
      <div v-for="(item,index) in subjectArr" :key="index" @mouseup="add" @mousedown.prevent="del(index)" ref="">{{item}}</div>
    </div>
  </div>
</template>

<script>
export default {
  data () {
    return {
      mouseText: '',
      subjectArr: ['政治', '数', '英']
    }
  },
  mounted () {
    window.onmouseup = () => {
      this.mouseText = ''
    }
  },
  methods: {
    move (item) {
      this.mouseText = item
      window.onmousemove = () => {
        const e = event || window.event;
        this.$refs.mouse.style.top = e.pageY + 'px'
        this.$refs.mouse.style.left = e.pageX + 15 + 'px'
      }
    },
    add () {
      this.subjectArr.push(this.mouseText)
    },
    del (index) {
      console.log(this.subjectArr[index]);
      this.subjectArr.splice(index, 1)
      window.onmousemove = () => {
        const e = event || window.event;
        this.$refs.mouse.style.top = e.pageY + 'px'
        this.$refs.mouse.style.left = e.pageX + 15 + 'px'
      }
    }
  }
}
</script>

<style>
* {
  cursor: default;
}
.mouse {
  position: absolute;
}
</style>
```

打印 html 内容

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
<table border="1">
  <tr>
    <th>Month</th>
    <th>Savings</th>
  </tr>
<!--startprint-->
  <tr>
    <td>January</td>
    <td>$100</td>
  </tr>
<!--endprint-->
</table>
</p>
  <script>
function doPrint() {
    const html = window.document.body.innerHTML;
    const start = "<!--startprint-->"; //开始打印标识字符串有17个字符
    const end = "<!--endprint-->"; //结束打印标识字符串
    let printHtml= html.substring(html.indexOf(start) + 17); //从开始打印标识之后的内容
    printHtml = printHtml.substring(0, printHtml.indexOf(end)); //截取开始标识和结束标识之间的内容
    window.document.body.innerHTML = printHtml //把需要打印的指定内容赋给body.innerHTML
    window.print() //调用浏览器的打印功能打印指定区域
    window.document.body.innerHTML = printHtml//重新给页面内容赋值；
}
doPrint()
</script>
</body>
</html>
```

## 图片预览

```html
<!DOCTYPE html>
<html>
  <head>
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1, user-scalable=no"
    />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <title>test</title>
    <script>
      //选择图片时预览功能
      function imageshow(source) {
        var file = source.files[0]
        var imageid = source.id
        if (window.FileReader) {
          var fr = new FileReader()
          fr.onloadend = function (e) {
            document.getElementById('portrait' + imageid).src = e.target.result
          }
          fr.readAsDataURL(file)
        }
        document.getElementById('image' + imageid).style.display = 'none'
        document.getElementById('show' + imageid).style.display = 'block'
      }
    </script>
  </head>
  <body>
    <div>
      <div id="image1">
        　　　　　　
        <p>上传截图</p>
        <input
          type="file"
          name="screenshot1"
          id="1"
          onchange="imageshow(this)"
        />
      </div>
      　　　　
      <div id="show1" style="display:none;">
        　　　　　　<img src="" id="portrait1" width="100" height="70" />
        　　　　
      </div>
      　　　　
      <div id="image2">
        <p>上传截图</p>
        <input
          type="file"
          name="screenshot2"
          id="2"
          onchange="imageshow(this)"
        />
      </div>
      　　　
      <div id="show2" style="display:none;">
        　　　　　　<img src="" id="portrait2" width="100" height="70" /> 　　　
      </div>
      <div id="image3">
        <p>上传截图</p>
        <input
          type="file"
          name="screenshot3"
          id="3"
          onchange="imageshow(this)"
        />
      </div>
      　　
      <div id="show3" style="display:none;">
        　　　　　　<img src="" id="portrait3" width="100" height="70" />
        　　　　
      </div>
    </div>
  </body>
</html>
```

## input 设置图标

方法一

将图标设置为 input 的背景

```html
 <style>
            input{
                border: none;
            }
            .box{
                height: 50px;
                background: yellow;
            }
            .box input{
                width: 200px;
                height: 30px;
                border-radius: 15px;
                margin: 10px 0;
                background: url(image/search.gif) no-repeat;
                background-color: white;
                background-position: 3px;
                padding-left: 30px;
                border: 1px solid black;
                outline: none;
            }
        </style>
    </head>
    <body>
        <div class="box">
            <input type="text" class="username" value="搜索"/>
        </div>
    </body>
```

方法二
使用绝对定位，相对定位

```html
<style >
            .box{
                width: 200px;
                position: relative;
            }
            .box .icon-search{
                background: url(image/search.gif) no-repeat;
                width: 20px;
                height: 20px;
                position: absolute;
                top: 6px;
                left: 0;
            }
            .box .username{
                padding-left: 30px;
                height: 25px;
            }
        </style>
    </head>
    <body>
        <div class="box">
            <i class="icon-search"></i>
            <input type="text" class="username" value="搜索"/>
        </div>
    </body>
```

## input 正则校验

```css
<template>
    <form>
        <input type="text" maxlength="10" placeholder="请输入用户名" v-model="user" required @input="checkUser">
        <p v-if="userCorrect">{{userMes}}</p>
        <input type="password" maxlength="10" placeholder="请输入密码" v-model="password" required @input="checkPassword">
        <p v-if="passwordCorrect">{{passwordMes}}</p>
    </form>
</template>

<script>
export default {
    data () {
        return {
            user: '',
            userCorrect: false,
            userMes: '请输入正确用户名,长度在4-10个字符',
            password: '',
            passwordCorrect: false,
            passwordMes: '请输入正确密码,长度在4-10个字符',
        }
    },
    methods: {
        checkUser () {
            const pattern = /^[0-9]{4,10}$/
            this.userCorrect = !pattern.test(this.user)
        },
        checkPassword () {
            const pattern = /^[0-9]{4,10}$/
            this.passwordCorrect = !pattern.test(this.password)
        }
    }
}
</script>

<style>
input {
    display: block;
    padding: 0 20px;
    outline: none;
    border: 1px solid #ccc;
    width: 150px;
    height: 40px;
    transition: all 300ms;
}
/*input内容合法时：边框颜色是绿色*/
 input:valid {
    border-color: green;
    box-shadow: inset 5px 0 0 green;
}
/* input内容非法时：边框颜色是红色*/
 input:invalid {
    border-color: red;
    box-shadow: inset 5px 0 0 red;
}
button {
    width: 190px;
    height: 40px;
    background-color: green;
    color: white;
    margin-top: 20px;
}
</style>
```

## 滚动底部请求数据

```js
this.$nextTick(() => {
  const body = this.$refs.instructions
  body.onscroll = () => {
    const scrollTop = body.scrollTop
    const clientHeight = body.clientHeight
    const scrollHeight = body.scrollHeight
    if (scrollTop + clientHeight >= scrollHeight - 50) {
      // 如果还有新的数据
      if (!this.finished) {
        this.page++ // 请求的页数
        this.getList() // 发起网络请求
      }
    }
  }
})
```

请求方法

```js
getList () {
            NewsList("post", {
                pageSize: 10,
                pageNum: this.page, // 页数参数
            }).then(res => {
                if (res.data.status == 200) {
                    this.con = [...this.con, ...res.data.data] // 合并新数据和旧数据
                    // 没有更多的数据了
                    if (res.data.data.length == 0) {
                        this.finished = true
                    }
                }
            })
        }
```

## 轮播图

```bash
npm i -s swiper
```

```vue
<template>
  <div class="swiper-box">
    <div class="swiper">
      <div class="swiper-wrapper">
        <div
          class="swiper-slide"
          v-for="(item, index) in swiperArr"
          :key="index"
        >
          <img :src="item.clientFileUrl" />
        </div>
      </div>
      <div class="swiper-pagination"></div>
    </div>
    <div class="bottom">
      <div class="text">
        <span>{{ swiperArr[swiperIndex].tittle }}</span>
      </div>
      <div class="dots">
        <div
          class="dot"
          :class="swiperIndex == index ? 'active' : ''"
          v-for="(item, index) in swiperArr"
          :key="index"
        ></div>
      </div>
    </div>
  </div>
</template>
<script>
import { BannerList } from '@/util/api.js'
import Swiper from 'swiper'
import 'swiper/swiper.min.css'
export default {
  data() {
    return {
      swiperArr: [{ tittle: '' }], // 轮播数组
      swiperIndex: 0
    }
  },
  mounted() {
    this.getList()
  },
  methods: {
    async getList() {
      const { data: res } = await BannerList(
        'post',
        {
          type: 4
        },
        'json'
      )
      if (res.status == 200) {
        const images = res.data.filter(
          (item) =>
            item.clientFileUrl.charAt(item.clientFileUrl.length - 1) == 'g'
        )
        this.swiperArr = images
        const that = this
        this.$nextTick(() => {
          new Swiper('.swiper', {
            autoplay: true, // 自动滑动,
            loop: true, // 循环
            observer: true, //修改swiper自己或子元素时，自动初始化swiper
            observeParents: true, //修改swiper的父元素时，自动初始化swiper
            pagination: {
              el: '.swiper-pagination'
            },
            on: {
              slideChangeTransitionStart: function () {
                if (this.activeIndex > that.swiperArr.length) {
                  return (that.swiperIndex = 0)
                }
                if (this.activeIndex == 0) {
                  return (that.swiperIndex = that.swiperArr.length - 1)
                }
                if (that.swiperIndex <= that.swiperArr.length) {
                  that.swiperIndex = this.activeIndex - 1
                }
              }
            }
          })
        })
      }
    }
  }
}
</script>

<style lang="less">
.swiper-box {
  width: 100%;
  height: 100vh;
  position: absolute;
  top: 0;
  overflow: hidden;

  .swiper-slide {
    overflow: hidden;

    img {
      width: 100%;
      height: 100vh;
    }
  }

  .bottom {
    position: absolute;
    bottom: 0px;
    left: 0px;
    height: 40px;
    padding: 0px 40px;
    width: 100%;
    z-index: 99;
    box-sizing: border-box;
    background-color: #a70003;

    .text {
      float: left;
      line-height: 40px;
      color: #fff;
      font-size: 20px;
    }

    .dots {
      float: right;
      display: flex;
      align-items: center;
      height: 40px;

      .dot {
        width: 10px;
        height: 10px;
        background: #909090;
        border-radius: 50%;
        margin-left: 10px;
      }

      .active {
        background: #fff;
      }
    }
  }
}
</style>
```
